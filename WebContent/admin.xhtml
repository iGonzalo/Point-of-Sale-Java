<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<h:head>
	<title>Reporte de Ventas</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link rel="icon" type="image/x-icon" href="" />
	<link
		href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
		rel="stylesheet" />
	<link rel="stylesheet" type="text/css"
		href="/puntoventa/assets/css/vendor/fontawesome/all.min.css" />
	<link rel="stylesheet" type="text/css"
		href="/puntoventa/assets/css/sb-admin-2.min.css" />

	<!--script src="https://code.jquery.com/jquery-1.12.4.min.js"
		integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
		crossorigin="anonymous"></script-->
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
		crossorigin="anonymous"></script>
	<script src="/puntoventa/assets/js/vendor/jquery/jquery.easing.min.js"
		type="text/javascript"></script>
	<script src="/puntoventa/assets/js/sb-admin-2.min.js"
		type="text/javascript"></script>

	<style type="text/css">
.ui-datatable table {
	border-collapse: collapse;
	width: 100%;
	table-layout: auto;
}

.ui-datepicker {
	width: 17em;
	padding: .2em .2em 0;
	display: none;
	background: ghostwhite;
}
</style>

	<script type="text/javascript">
		PrimeFaces.locales['es'] = {
			closeText : 'Cerrar',
			prevText : 'Anterior',
			nextText : 'Siguiente',
			monthNames : [ 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo',
					'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre',
					'Noviembre', 'Diciembre' ],
			monthNamesShort : [ 'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
					'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic' ],
			dayNames : [ 'Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves',
					'Viernes', 'Sábado' ],
			dayNamesShort : [ 'Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab' ],
			dayNamesMin : [ 'D', 'L', 'M', 'MI', 'J', 'V', 'S' ],
			weekHeader : 'Semana',
			firstDay : 1,
			isRTL : false,
			showMonthAfterYear : false,
			yearSuffix : '',
			currentText : 'Fecha actual',
			ampm : false,
			month : 'Mes',
			week : 'Semana',
			day : 'Día',
			allDayText : 'Todo el día'
		};
	</script>

</h:head>

<h:body id="page-top" class="sidebar-toggled">

	<!-- Page Wrapper -->
	<div id="wrapper">

		<!-- Sidebar -->
		<ul
			class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion toggled"
			id="accordionSidebar">

			<!-- Sidebar - Brand -->
			<a
				class="sidebar-brand d-flex align-items-center justify-content-center"
				href="admin.xhtml">
				<div class="sidebar-brand-icon rotate-n-15">
					<i class="fas fa-cash-register"></i>
				</div>
				<div class="sidebar-brand-text mx-3">Punto de Venta</div>
			</a>

			<!-- Divider -->
			<hr class="sidebar-divider my-0"></hr>

			<!-- Nav Item - Dashboard -->
			<li class="nav-item active"><a class="nav-link"
				href="admin.xhtml"> <i class="fas fa-shopping-cart"></i> <span>Reporte
						de Ventas</span></a></li>

			<!-- Divider -->
			<hr class="sidebar-divider"></hr>

			<!-- Nav Item - Pages Collapse Menu -->
			<li class="nav-item"><a class="nav-link collapsed" href=""
				data-toggle="collapse" data-target="#collapseTwo"
				aria-expanded="true" aria-controls="collapseTwo"> <i
					class="fas fa-shopping-basket"></i> <span>Productos</span></a>
				<div id="collapseTwo" class="collapse" aria-labelledby="headingTwo"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">Producto:</h6>
						<a class="collapse-item" href="producto.xhtml">Administrar
							Productos</a>
					</div>
				</div></li>

			<!-- Divider -->
			<hr class="sidebar-divider"></hr>

		</ul>
		<!-- End of Sidebar -->

		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- Main Content -->
			<div id="content">

				<!-- Topbar -->
				<nav
					class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

					<!-- Sidebar Toggle (Topbar) -->
					<button id="sidebarToggleTop"
						class="btn btn-link d-md-none rounded-circle mr-3">
						<i class="fa fa-bars"></i>
					</button>

					<!-- Topbar Navbar -->
					<ul class="navbar-nav ml-auto">

						<div class="topbar-divider d-none d-sm-block"></div>

						<!-- Nav Item - User Information -->
						<li class="nav-item dropdown no-arrow"><a
							class="nav-link dropdown-toggle" href="#" id="userDropdown"
							role="button" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="false"> <span
								class="mr-2 d-none d-lg-inline text-gray-600 small">#{sessionBean.usuario}</span>
						</a> <!-- Dropdown - User Information -->
							<div
								class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
								aria-labelledby="userDropdown">
								<a class="dropdown-item" href="#"> <i
									class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> Perfil
								</a> <a class="dropdown-item" href="#"> <i
									class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
									Configuración
								</a> <a class="dropdown-item" href="#"> <i
									class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
									Registro de Actividad
								</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#" data-toggle="modal"
									data-target="#logoutModal"> <i
									class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
									Salir
								</a>
							</div></li>
					</ul>

				</nav>
				<!-- End of Topbar -->

				<!-- Begin Page Content -->
				<div style="padding-left: 1rem;">

					<!-- Page Heading -->
					<div class="d-sm-flex align-items-center justify-content-between">
						<h3 class="mb-0 text-gray-800">Reporte de Ventas</h3>
						<div class="col-xl-3 col-md-6"></div>
					</div>
				</div>
				<hr style="border-bottom: 3px solid #ffd400;"></hr>
				<p></p>

				<div class="col-12">
					<h:form>
						<div class="form-row">
							<div class="col-md-2 mb-2">
								<p:datePicker value="#{reporteVentasBean.date}" locale="es"
									pattern="dd/MM/yyyy" readonlyInput="true" monthNavigator="true"
									maxdate="#{reporteVentasBean.maxDate}">
									<p:ajax event="dateSelect" update="listar" />
								</p:datePicker>
							</div>
							<div>
								<p:commandButton value="Buscar" class="btn btn-success btn-sm"
									icon="fas fa-search" update="ventasDT" id="listar"
									disabled="#{reporteVentasBean.date eq null}"
									action="#{reporteVentasBean.setList()}"></p:commandButton>
							</div>
						</div>

						<p:messages id="messages" showDetail="true" closable="true">
							<p:autoUpdate />
							<p:ajaxStatus
								oncomplete="setTimeout(function() { $('.ui-messages').slideUp(); }, 2000)" />
						</p:messages>

						<p:dataTable id="ventasDT" var="detalleVenta"
							class="table table-dark table-striped table-responsive-sm"
							emptyMessage="Aquí se verán los registros de ventas."
							value="#{reporteVentasBean.detalle}" widgetVar="dt"
							rowIndexVar="index">

							<!--f:facet name="{Exporters}">
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
								<div style="float: right; padding-top: 5px;">
									<h:commandLink>
										<p:graphicImage value="assets/img/xlsx.png" width="24" />
										<p:dataExporter type="xlsxstream" target="ventasDT"
											subTable="true" fileName="reporte" />
									</h:commandLink>

									<p:commandLink ajax="false">
										<p:graphicImage value="assets/img/pdf.png" width="24" />
										<pe:exporter type="pdf" target="ventasDT, productosDT"
											fileName="reporte" />
									</p:commandLink>
								</div>
							</f:facet -->

							<p:column headerText="#">
								<h:outputText value="#{index + 1}" />
							</p:column>

							<p:column headerText="Fecha y Hora">
								<h:outputText value="#{detalleVenta.fechaHora}" />
							</p:column>

							<p:column headerText="Productos">
								<p:dataTable id="productosDT" var="productos" 
									class="table table-dark table-striped table-responsive-sm"
									value="#{reporteVentasBean.productoList.get(index)}"
									widgetVar="dt" rowIndexVar="i">
									<p:column headerText="#">
										<h:outputText value="#{i + 1}" />
									</p:column>

									<p:column headerText="Codigo">
										<h:outputText value="#{productos.codigo}" />
									</p:column>

									<p:column headerText="Nombre">
										<h:outputText value="#{productos.nombre}" />
									</p:column>

									<p:column headerText="Cantidad">
										<h:outputText value="#{productos.cantidad}" />
									</p:column>

									<p:column headerText="Precio">
										<h:outputText value="$ #{productos.precio}" />
									</p:column>

									<p:column headerText="Subtotal">
										<h:outputText value="$ #{productos.subtotal}" />
									</p:column>
								</p:dataTable>
							</p:column>

							<p:column headerText="Total">
								<h:outputText value="$ #{detalleVenta.total}" />
							</p:column>

							<p:columnGroup type="footer" rendered="#{reporteVentasBean.total gt 0.0}">
								<p:row style="background: orange;">
									<p:column colspan="3" footerText="Total: "  />
									<p:column id="total" footerText="$ #{reporteVentasBean.total}" />
								</p:row>
							</p:columnGroup>

						</p:dataTable>
					</h:form>
				</div>

			</div>
			<!-- End of Main Content -->

			<!-- Footer -->
			<footer class="sticky-footer bg-white">
				<div class="container my-auto">
					<div class="copyright text-center my-auto">
						<span>Copyright Gonzalo León 2019</span>
					</div>
				</div>
			</footer>
			<!-- End of Footer -->
		</div>
	</div>

	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="#page-top"> <i
		class="fas fa-angle-up"></i>
	</a>

	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">
						<i class="fas fa-exclamation-circle"></i> Aviso
					</h5>
					<button class="close" type="button" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Se perderán todos los movimientos que
					no hayan sido guardados.</div>
				<div class="modal-footer">
					<h:form>
						<button class="btn btn-secondary" type="button"
							data-dismiss="modal">Cancelar</button>
						<p:commandButton value="Salir" id="salir"
							class="btn btn-outline-danger btn-sm"
							action="#{loginBean.logout}" ajax="false" type="submit" />
					</h:form>
				</div>
			</div>
		</div>
	</div>
</h:body>
</html>